#{stylesheet src:'pointer.css' /}
#{extends 'leaflet.html' /}

<div class="col-md-8" style="height: 100%; padding-left: 0px;">
    <div class="col-md-8" id="map" style="position: fixed;"></div>
</div>
<div class="col-md-4">
    <h1>Route <small>Click on the map to change start or destination.</small></h1>

    <div class="well">
        <img src="/public/images/marker-icon-green.png" style="width: 25px; height: 41px;"> [ ${params.from} ]
        <img src="/public/images/marker-icon-red.png" style="width: 25px; height: 41px;"> [ ${params.to} ]
    </div>

    %{
    for (feature in routes.features) {
    }%
    <div>
        ${feature.properties.comment} (${feature.properties.distance.format('##')}m)
        <ul>
            %{
            for (maneuver in feature.properties.maneuvers) {
            }%
            <li><img src="${maneuver.iconUrl}"/> ${maneuver.narrative}</li>
            %{
            }
            }%
        </ul>
    </div>
    %{
    }
    }%

</div>

<script>
var geoJson = ${geoJson.raw()};
var map = L.map('map',{
                        zoom: 18,
   						maxZoom: 20
					});

L.tileLayer('http://{s}.tiles.mapbox.com/v3/tzorzan.ik1cmo25/{z}/{x}/{y}.png').addTo(map);

var feature = L.geoJson(geoJson).addTo(map);

var greenIcon = L.icon({
                    iconUrl: '/public/images/marker-icon-green.png',
                    iconRetinaUrl: '/public/images/marker-icon-green@2x.png',
                    iconSize: [25, 41],
		            iconAnchor: [12, 41]
                });

var redIcon = L.icon({
                    iconUrl: '/public/images/marker-icon-red.png',
                    iconRetinaUrl: '/public/images/marker-icon-red@2x.png',
                    iconSize: [25, 41],
		            iconAnchor: [12, 41]
                });

%{
  for (feature in routes.features) {
}%
    L.marker([${feature.geometry.coordinates.get(0)[1]},${feature.geometry.coordinates.get(0)[0]}], {icon: greenIcon}).addTo(map);
    L.marker([${feature.geometry.coordinates.get(feature.geometry.coordinates.size-1)[1]},${feature.geometry.coordinates.get(feature.geometry.coordinates.size-1)[0]}], {icon: redIcon}).addTo(map);
%{
  }
}%

map.fitBounds(feature.getBounds(), {padding: [20, 20]});

map.on('click', function(e) {
    var lat = e.latlng.lat.toFixed(7);
    var lon = e.latlng.lng.toFixed(7);

    var content = '<h6>Position</h6>' +
                  '<small>[ ' + lat + ',' + lon + ' ]</small>' +
                  '<div class="btn-group btn-group-sm btn-group-justified" role="group" style="margin-top:6px;">' +
                  '  <div class="btn-group" role="group">' +
                  '    <button type="button" class="btn btn-success" onclick="location.href=\'@{Application.route}?from='+lat+','+lon+'&to=${params.to}\'">from</button>' +
                  '  </div>' +
                  '  <div class="btn-group" role="group">' +
                  '    <button type="button" class="btn btn-danger" onclick="location.href=\'@{Application.route}?from=${params.from}&to='+lat+','+lon+'\'">to</button>' +
                  '  </div>' +
                  '</div>';

    var popup = L.popup().setLatLng(e.latlng).setContent(content).openOn(map);
});
</script>
