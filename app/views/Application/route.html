#{stylesheet src:'pointer.css' /}
#{extends 'leaflet.html' /}
#{set title:'Route' /}
<div class="row" style="height: 100%;">
    <div class="col-md-8" style="height: 100%;">
        <div id="map"></div>
    </div>
    <div class="col-md-4">
        <h4>Route Info</h4>
        <h6>Click on the map to change <strong>start</strong> or <strong>destination</strong>.</h6>

        <ul class="list-unstyled">
            <li>from: <img src="/public/images/marker-icon-green.png" style="width: 25px; height: 41px;"> ${params.from}</li>
            <li>to: <img src="/public/images/marker-icon-red.png" style="width: 25px; height: 41px;"> ${params.to}</li>
        </ul>

        <div>
            ${spdRoute.properties.comment} (${spdRoute.properties.distance.format('##')}m)
            <ul>
                %{
                for (maneuver in spdRoute.properties.maneuvers) {
                }%
                <li>${maneuver.narrative}</li>
                %{
                }
                }%
            </ul>
        </div>
    </div>
</div>



<script>
var geoJson = ${geoJson.raw()};
var map = L.map('map',{
                        zoom: 18,
   						maxZoom: 18
					});

L.tileLayer('http://{s}.tiles.mapbox.com/v3/tzorzan.ik1cmo25/{z}/{x}/{y}.png').addTo(map);

var feature = L.geoJson(geoJson).addTo(map);

var greenIcon = L.icon({
                    iconUrl: '/public/images/marker-icon-green.png',
                    iconRetinaUrl: '/public/images/marker-icon-green@2x.png',
                    iconSize: [25, 41],
		            iconAnchor: [12, 41]
                });

var redIcon = L.icon({
                    iconUrl: '/public/images/marker-icon-red.png',
                    iconRetinaUrl: '/public/images/marker-icon-red@2x.png',
                    iconSize: [25, 41],
		            iconAnchor: [12, 41]
                });

L.marker([${spdRoute.geometry.coordinates.get(0)[1]},${spdRoute.geometry.coordinates.get(0)[0]}], {icon: greenIcon}).addTo(map);
L.marker([${spdRoute.geometry.coordinates.get(spdRoute.geometry.coordinates.size()-1)[1]},${spdRoute.geometry.coordinates.get(spdRoute.geometry.coordinates.size()-1)[0]}], {icon: redIcon}).addTo(map);

map.fitBounds(feature.getBounds(), {padding: [20, 20]});

map.on('click', function(e) {
    var lat = e.latlng.lat.toFixed(7);
    var lon = e.latlng.lng.toFixed(7);

    var content = '<h6>Position</h6>' +
                  '<small>( ' + lat + ',' + lon + ' )</small>' +
                  '<div class="btn-group btn-group-sm btn-group-justified" role="group" style="margin-top:6px;">' +
                  '  <div class="btn-group" role="group">' +
                  '    <button type="button" class="btn btn-success" onclick="location.href=\'@{Application.route}?from='+lat+','+lon+'&to=${params.to}\'">from</button>' +
                  '  </div>' +
                  '  <div class="btn-group" role="group">' +
                  '    <button type="button" class="btn btn-danger" onclick="location.href=\'@{Application.route}?from=${params.from}&to='+lat+','+lon+'\'">to</button>' +
                  '  </div>' +
                  '</div>';

    var popup = L.popup().setLatLng(e.latlng).setContent(content).openOn(map);
});
</script>
